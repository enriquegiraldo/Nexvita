# Drolean – Project Structure & Architecture

## 1) Repository overview
This repository contains:
- A **React + Vite** frontend under `client/`
- A **Node.js (Express)** backend under `server/`
- A **Firebase Functions** deployment configuration that points to `server/`
- A **PostgreSQL** schema used by the backend (`server/schema.sql`)

## 2) High-level directory tree

```
Drolean/
├─ .firebaserc
├─ firebase.json
├─ .gitignore
├─ package.json
├─ package-lock.json
├─ dist/                     # (optional build output; may be empty)
├─ client/
│  ├─ README.md
│  ├─ index.html
│  ├─ vite.config.js
│  ├─ tailwind.config.js
│  ├─ eslint.config.js
│  ├─ vercel.json
│  ├─ old_app.jsx            # legacy/previous app file
│  ├─ public/
│  │  └─ vite.svg
│  ├─ src/
│  │  ├─ main.jsx            # React entrypoint
│  │  ├─ App.jsx             # App composition + section layout
│  │  ├─ index.css           # global styles
│  │  ├─ assets/
│  │  │  └─ react.svg
│  │  └─ components/
│  │     ├─ layout/
│  │     │  ├─ Navbar.jsx
│  │     │  └─ Footer.jsx
│  │     ├─ sections/
│  │     │  ├─ Hero.jsx
│  │     │  ├─ About.jsx
│  │     │  ├─ Services.jsx
│  │     │  ├─ Results.jsx
│  │     │  ├─ Anamnesis.jsx
│  │     │  └─ Contact.jsx
│  │     └─ ui/
│  │        └─ WhatsAppButton.jsx
│  └─ dist/                  # Vite build output
└─ server/
   ├─ index.js               # Firebase Functions entry (exports `api`)
   ├─ package.json
   ├─ package-lock.json
   ├─ schema.sql             # PostgreSQL schema
   └─ src/
      ├─ index.js            # Local dev entry (starts Express on PORT)
      ├─ app.js              # Express app wiring (middleware + routes)
      ├─ db.js               # PostgreSQL connection pool
      ├─ routes/
      │  └─ anamnesis.js      # /api/anamnesis endpoint
      └─ controllers/
         └─ anamnesisController.js
```

## 3) Frontend architecture (React + Vite)

### 3.1 Entry points
- **`client/index.html`**: HTML shell containing the `#root` mount.
- **`client/src/main.jsx`**: Bootstraps React and renders `<App />`.
- **`client/src/App.jsx`**:
  - Assembles the landing page sections: `Hero`, `About`, `Services`, `Results`, `Anamnesis`, `Contact`.
  - Provides the `handleWhatsAppClick` handler shared across components.

### 3.2 Components organization
- **`client/src/components/layout/`**: Page layout components.
  - `Navbar.jsx`: navigation + social links
  - `Footer.jsx`: footer content + social links
- **`client/src/components/sections/`**: The landing page sections.
  - `Anamnesis.jsx` is the form that sends data to the backend.
- **`client/src/components/ui/`**: Reusable UI widgets.
  - `WhatsAppButton.jsx`: floating WhatsApp CTA button.

### 3.3 Network calls / API usage
- The anamnesis form posts JSON to:
  - `POST {VITE_API_BASE_URL}/anamnesis`
  - Default base: `http://localhost:3000/api`

## 4) Backend architecture (Node.js + Express)

### 4.1 Entrypoints
- **Local run**: `server/src/index.js`
  - Starts Express listening on `PORT` (default `3000`).
- **Firebase Functions**: `server/index.js`
  - Exports the Express app as `exports.api = onRequest(app)`.

### 4.2 Express app wiring
- **`server/src/app.js`**
  - Loads environment variables via `dotenv`.
  - Middleware: `cors`, `express.json()`.
  - Routes mounted under `/api`.

### 4.3 Routes & controllers
- **Route**: `server/src/routes/anamnesis.js`
  - `POST /api/anamnesis` → `anamnesisController.submitAnamnesis`
- **Controller**: `server/src/controllers/anamnesisController.js`
  - Validates request payload.
  - Persists records into PostgreSQL via `server/src/db.js`.

## 5) Database layer (PostgreSQL)

### 5.1 Connection
- **`server/src/db.js`** creates a `pg.Pool`.
- Env vars supported:
  - `DATABASE_URL` (recommended)
  - Or: `PGHOST`, `PGPORT`, `PGUSER`, `PGPASSWORD`, `PGDATABASE`
  - Optional: `PGSSLMODE=require`

### 5.2 Schema
- **`server/schema.sql`** contains the DDL required to create the database objects used by the backend.

## 6) Runtime data flow (end-to-end)

1. User fills the form in **`client/src/components/sections/Anamnesis.jsx`**.
2. Frontend sends `POST /api/anamnesis` to the backend.
3. Express receives the request in **`server/src/app.js`** and dispatches to:
   - `server/src/routes/anamnesis.js`
   - `server/src/controllers/anamnesisController.js`
4. Controller uses **`server/src/db.js`** to write to **PostgreSQL**.
5. API responds with success JSON.

## 7) Deployment notes (where things live)
- **Firebase Functions source** is set to **`server/`** in `firebase.json`.
- **Frontend build output** is generated by Vite into `client/dist/`.

